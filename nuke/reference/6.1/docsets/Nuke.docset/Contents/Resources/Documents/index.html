<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Nuke  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Nuke  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Nuke Docs</a> (86% documented)</p>
        <p class="header-right"><a href="https://github.com/kean/nuke"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Nuke Reference</a>
        <img id="carat" src="img/carat.png" />
        Nuke  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Cache.html">Cache</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CancellationTokenSource.html">CancellationTokenSource</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DataLoader.html">DataLoader</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DataLoader/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Loader.html">Loader</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Loader/Options.html">– Options</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Loader/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Manager.html">Manager</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Preheater.html">Preheater</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/Result.html">Result</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/ImageView.html">ImageView</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:4Nuke13cancelRequestyyXl3for_tF">cancelRequest(for:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4Nuke9loadImagey10Foundation3URLV4with_AA6Target_p4intotF">loadImage(with:into:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4Nuke9loadImageyAA7RequestV4with_AA6Target_p4intotF">loadImage(with:into:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4Nuke9loadImagey10Foundation3URLV4with_yXl4intoyAA6ResultOySo7UIImageCG_Sbtc7handlertF">loadImage(with:into:handler:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4Nuke9loadImageyAA7RequestV4with_yXl4intoyAA6ResultOySo7UIImageCG_Sbtc7handlertF">loadImage(with:into:handler:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/Caching.html">Caching</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DataDecoding.html">DataDecoding</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DataLoading.html">DataLoading</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Loading.html">Loading</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Processing.html">Processing</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Target.html">Target</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/AnyProcessor.html">AnyProcessor</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CancellationToken.html">CancellationToken</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DataDecoder.html">DataDecoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DataDecoderComposition.html">DataDecoderComposition</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Decompressor.html">Decompressor</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Decompressor/ContentMode.html">– ContentMode</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ProcessorComposition.html">ProcessorComposition</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Request.html">Request</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Request/MemoryCacheOptions.html">– MemoryCacheOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Request/Priority.html">– Priority</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/Image">Image</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4Nuke5Imagea">Image</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/ImageView">ImageView</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4Nuke9ImageViewa">ImageView</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4Nuke15ProgressHandlera">ProgressHandler</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p align="center"><img src="https://cloud.githubusercontent.com/assets/1567433/13918338/f8670eea-ef7f-11e5-814d-f15bdfd6b2c0.png" height="180"/>

<p align="center">
<img src="https://img.shields.io/cocoapods/v/Nuke.svg?label=version">
<img src="https://img.shields.io/badge/supports-CocoaPods%20%7C%20Carthage%20%7C%20SwiftPM-green.svg">
<img src="https://img.shields.io/badge/platforms-iOS%20%7C%20macOS%20%7C%20watchOS%20%7C%20tvOS-lightgrey.svg">
<a href="https://travis-ci.org/kean/Nuke"><img src="https://img.shields.io/travis/kean/Nuke/master.svg"></a>
</p>

<p>A powerful <strong>image loading</strong> and <strong>caching</strong> framework which allows for hassle-free image loading in your app.</p>
<h1 id='a-name-h_features-a-features' class='heading'><a name="h_features"></a>Features</h1>

<ul>
<li>Load images into image views or other targets</li>
<li>Two <a href="https://kean.github.io/post/image-caching">cache layers</a>, fast LRU memory cache</li>
<li><a href="https://github.com/kean/Nuke-Alamofire-Plugin">Alamofire</a>, <a href="https://github.com/kean/Nuke-FLAnimatedImage-Plugin">FLAnimatedImage</a>, <a href="https://github.com/kean/Nuke-Gifu-Plugin">Gifu</a> integrations</li>
<li>Can be used with networking, caching libraries <a href="#h_design">of your choice</a></li>
<li><a href="https://github.com/kean/RxNuke">RxNuke</a> with RxSwift extensions</li>
<li>Automates <a href="https://kean.github.io/post/image-preheating">prefetching</a> with <a href="https://github.com/kean/Preheat">Preheat</a> (<em>deprecated in iOS 10</em>)</li>
<li>Small (under 1200 lines), <a href="https://github.com/kean/Image-Frameworks-Benchmark">fast</a> and reliable</li>
</ul>

<blockquote>
<p><a href="https://github.com/kean/Nuke/tree/nuke7">Nuke 7</a> is in development. If you&rsquo;d like to contribute or have some suggestions or feature requests please open an issue, a pull request or contact me on <a href="https://twitter.com/a_grebenyuk">Twitter</a>.</p>
</blockquote>
<h1 id='a-name-h_getting_started-a-quick-start' class='heading'><a name="h_getting_started"></a>Quick Start</h1>

<blockquote>
<p>Upgrading from the previous version? Use a <a href="https://github.com/kean/Nuke/blob/master/Documentation/Migrations"><strong>Migration Guide</strong></a>.</p>
</blockquote>

<p>This README has five sections:</p>

<ul>
<li>Complete <a href="#h_usage"><strong>Usage Guide</strong></a> - best place to start</li>
<li>Detailed <a href="#h_design"><strong>Image Pipeline</strong></a> description</li>
<li>Section dedicated to <a href="h_performance"><strong>Performance</strong></a></li>
<li>List of available <a href="#h_plugins"><strong>Extensions</strong></a></li>
<li>List of <a href="#h_requirements"><strong>Requirements</strong></a></li>
</ul>

<p>More information is available in <a href="https://github.com/kean/Nuke/blob/master/Documentation/"><strong>Documentation</strong></a> directory and a full <a href="http://kean.github.io/Nuke/reference/6.0/index.html"><strong>API Reference</strong></a>. When you are ready to install Nuke you can follow an <a href="https://github.com/kean/Nuke/blob/master/Documentation/Guides/Installation%20Guide.md"><strong>Installation Guide</strong></a> - all major package managers are supported.</p>
<h1 id='a-name-h_usage-a-usage' class='heading'><a name="h_usage"></a>Usage</h1>
<h4 id='loading-images-into-targets' class='heading'>Loading Images into Targets</h4>

<p>You can load an image into an image view with a single line of code:</p>
<pre class="highlight swift"><code><span class="kt">Manager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">loadImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">into</span><span class="p">:</span> <span class="n">imageView</span><span class="p">)</span>
</code></pre>

<p>Nuke will automatically load image data, decompress it in the background, store image in memory cache and display it.</p>

<blockquote>
<p>To learn more about the image pipeline <a href="#h_design">see the next section</a>.</p>
</blockquote>

<p><code><a href="Classes/Manager.html">Manager</a></code> keeps track of each <em>target</em>. When you request an image for a target any previous outstanding requests get cancelled. The same happens automatically when the target is deallocated.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">collectionView</span><span class="p">(</span><span class="n">_</span> <span class="nv">collectionView</span><span class="p">:</span> <span class="kt">UICollectionView</span><span class="p">,</span> <span class="n">cellForItemAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UICollectionViewCell</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="c1">// Prepare image view for reuse.</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">imageView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="c1">// Previous requests for the image view get cancelled.</span>
    <span class="kt">Manager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">loadImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">into</span><span class="p">:</span> <span class="n">cell</span><span class="o">.</span><span class="n">imageView</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre>
<h4 id='targets' class='heading'>Targets</h4>

<p>What can be a <em>target</em>? Anything that implements <code><a href="Protocols/Target.html">Target</a></code> protocol:</p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">Target</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="c1">/// Callback that gets called when the request is completed.</span>
    <span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">response</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Image</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">isFromMemoryCache</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Nuke extends <code>UIImageView</code> (<code>NSImageView</code> on macOS) to adopt <code><a href="Protocols/Target.html">Target</a></code> protocol. You can do the same for you own classes.</p>

<p>Protocols are great, but sometimes you might want something a bit more flexible. Fortunately, there is a <code><a href="Functions.html#/s:4Nuke9loadImagey10Foundation3URLV4with_yXl4intoyAA6ResultOySo7UIImageCG_Sbtc7handlertF">loadImage(with:into:handler:)</a></code> method which works with arbitrary objects as targets:</p>
<pre class="highlight swift"><code><span class="n">indicator</span><span class="o">.</span><span class="nf">startAnimating</span><span class="p">()</span>
<span class="kt">Manager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">loadImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span> <span class="nv">into</span><span class="p">:</span> <span class="n">view</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="n">view</span><span class="p">]</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
    <span class="n">view</span><span class="p">?</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">value</span>
    <span class="n">indicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>
<h4 id='customizing-requests' class='heading'>Customizing Requests</h4>

<p>Each request is represented by a <code><a href="Structs/Request.html">Request</a></code> struct. A request can be created with either <code>URL</code> or <code>URLRequest</code>.</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Request</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="c1">// var request = Request(urlRequest: URLRequest(url: url))</span>

<span class="c1">// Change memory cache policy:</span>
<span class="n">request</span><span class="o">.</span><span class="n">memoryCacheOptions</span><span class="o">.</span><span class="n">writeAllowed</span> <span class="o">=</span> <span class="kc">false</span>

<span class="c1">// Track progress:</span>
<span class="n">request</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="p">{</span> <span class="n">completed</span><span class="p">,</span> <span class="n">total</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="c1">// Update the request priority:</span>
<span class="n">request</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="o">.</span><span class="n">high</span>

<span class="kt">Manager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">loadImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span> <span class="nv">into</span><span class="p">:</span> <span class="n">imageView</span><span class="p">)</span>
</code></pre>
<h4 id='processing-images' class='heading'>Processing Images</h4>

<p>Nuke can process images for you. The first option is to resize the image using a <code><a href="Structs/Request.html">Request</a></code>:</p>
<pre class="highlight swift"><code><span class="c1">/// Target size is in pixels.</span>
<span class="kt">Request</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">targetSize</span><span class="p">:</span> <span class="kt">CGSize</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">640</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">320</span><span class="p">),</span> <span class="nv">contentMode</span><span class="p">:</span> <span class="o">.</span><span class="n">aspectFill</span><span class="p">)</span>
</code></pre>

<p>To perform a custom tranformation use a <code>processed(key:closure:)</code> method. Her&rsquo;s how to create a circular avatar using <a href="https://github.com/gavinbunney/Toucan">Toucan</a>:</p>
<pre class="highlight swift"><code><span class="kt">Request</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="nf">process</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="s">"circularAvatar"</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">Toucan</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span><span class="o">.</span><span class="nf">maskWithEllipse</span><span class="p">()</span><span class="o">.</span><span class="n">image</span>
<span class="p">}</span>
</code></pre>

<p>All of those APIs are built on top of <code><a href="Protocols/Processing.html">Processing</a></code> protocol. If you&rsquo;d like to you can implement your own processors that adopt it. Keep in mind that <code><a href="Protocols/Processing.html">Processing</a></code> also requires <code>Equatable</code> conformance which helps Nuke identify images in memory cache.</p>

<blockquote>
<p>See <a href="https://github.com/kean/Nuke/blob/master/Documentation/Guides/Core%20Image%20Integration%20Guide.md">Core Image Integration Guide</a> for more info about using Core Image with Nuke</p>
</blockquote>
<h4 id='loading-images-w-o-targets' class='heading'>Loading Images w/o Targets</h4>

<p>You can also use <code><a href="Classes/Manager.html">Manager</a></code> to load images directly without a target:</p>
<pre class="highlight swift"><code><span class="kt">Manager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">loadImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle response</span>
<span class="p">}</span>
</code></pre>

<p>If you&rsquo;d like to cancel the requests, use a <a href="https://kean.github.io/post/cancellation-token">cancellation token</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">cts</span> <span class="o">=</span> <span class="kt">CancellationTokenSource</span><span class="p">()</span>
<span class="kt">Manager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">loadImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">token</span><span class="p">:</span> <span class="n">cts</span><span class="o">.</span><span class="n">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle response</span>
<span class="p">}</span>
<span class="n">cts</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span>
</code></pre>
<h4 id='using-memory-and-disk-cache' class='heading'>Using Memory and Disk Cache</h4>

<p>Default Nuke&rsquo;s <code><a href="Classes/Manager.html">Manager</a></code> has two cache layers.</p>

<p>First, there is a memory cache for storing processed images ready for display. You can get a direct access to this cache:</p>
<pre class="highlight swift"><code><span class="c1">// Configure cache</span>
<span class="kt">Cache</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">costLimit</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">100</span> <span class="c1">// 100 MB</span>
<span class="kt">Cache</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">countLimit</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">// Read and write images</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Request</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="kt">Cache</span><span class="o">.</span><span class="n">shared</span><span class="p">[</span><span class="n">request</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
<span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="kt">Cache</span><span class="o">.</span><span class="n">shared</span><span class="p">[</span><span class="n">request</span><span class="p">]</span>

<span class="c1">// Clear cache</span>
<span class="kt">Cache</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">removeAll</span><span class="p">()</span>
</code></pre>

<p>To store unprocessed image data Nuke uses a <code>URLCache</code> instance:</p>
<pre class="highlight swift"><code><span class="c1">// Configure cache</span>
<span class="kt">DataLoader</span><span class="o">.</span><span class="n">sharedUrlCache</span><span class="o">.</span><span class="n">diskCapacity</span> <span class="o">=</span> <span class="mi">100</span>
<span class="kt">DataLoader</span><span class="o">.</span><span class="n">sharedUrlCache</span><span class="o">.</span><span class="n">memoryCapacity</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">// Read and write responses</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Request</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="kt">DataLoader</span><span class="o">.</span><span class="n">sharedUrlCache</span><span class="o">.</span><span class="nf">cachedResponse</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">urlRequest</span><span class="p">)</span>
<span class="kt">DataLoader</span><span class="o">.</span><span class="n">sharedUrlCache</span><span class="o">.</span><span class="nf">removeCachedResponse</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">urlRequest</span><span class="p">)</span>

<span class="c1">// Clear cache</span>
<span class="kt">DataLoader</span><span class="o">.</span><span class="n">sharedUrlCache</span><span class="o">.</span><span class="nf">removeAllCachedResponses</span><span class="p">()</span>
</code></pre>
<h4 id='preheating-images' class='heading'>Preheating Images</h4>

<p><a href="https://kean.github.io/post/image-preheating">Preheating</a> (prefetching) means loading images ahead of time in anticipation of their use. Nuke provides a <code><a href="Classes/Preheater.html">Preheater</a></code> class that does just that:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">preheater</span> <span class="o">=</span> <span class="kt">Preheater</span><span class="p">(</span><span class="nv">manager</span><span class="p">:</span> <span class="kt">Manager</span><span class="o">.</span><span class="n">shared</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">requests</span> <span class="o">=</span> <span class="n">urls</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Request</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="o">.</span><span class="n">low</span>
    <span class="k">return</span> <span class="n">request</span>
<span class="p">}</span>

<span class="c1">// User enters the screen:</span>
<span class="n">preheater</span><span class="o">.</span><span class="nf">startPreheating</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">requests</span><span class="p">)</span>

<span class="c1">// User leaves the screen:</span>
<span class="n">preheater</span><span class="o">.</span><span class="nf">stopPreheating</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">requests</span><span class="p">)</span>
</code></pre>

<p>You can use Nuke in combination with <a href="https://github.com/kean/Preheat">Preheat</a> library which automates preheating of content in <code>UICollectionView</code> and <code>UITableView</code>. On iOS 10.0 you might want to use new <a href="https://developer.apple.com/reference/uikit/uitableviewdatasourceprefetching">prefetching APIs</a> provided by iOS instead.</p>

<blockquote>
<p>Check out <a href="https://github.com/kean/Nuke/blob/master/Documentation/Guides/Performance%20Guide.md">Performance Guide</a> to see what else you can do to improve performance</p>
</blockquote>
<h4 id='using-rxnuke' class='heading'>Using RxNuke</h4>

<p><a href="https://github.com/kean/RxNuke">RxNuke</a> adds <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a> extensions for Nuke and enables many common use cases:</p>

<ul>
<li><a href="https://github.com/kean/RxNuke#going-from-low-to-high-resolution">Going from low to high resolution</a></li>
<li><a href="https://github.com/kean/RxNuke#loading-the-first-available-image">Loading the first available image</a></li>
<li><a href="https://github.com/kean/RxNuke#showing-stale-image-while-validating-it">Showing stale image while validating it</a></li>
<li><a href="https://github.com/kean/RxNuke#load-multiple-images-display-all-at-once">Load multiple images, display all at once</a></li>
<li><a href="https://github.com/kean/RxNuke#auto-retry">Auto retry on failures</a></li>
<li>And <a href="https://github.com/kean/RxNuke#use-cases">more&hellip;</a></li>
</ul>

<p>Here&rsquo;s an example of how easy it is to load go flow log to high resolution:</p>
<pre class="highlight swift"><code><span class="kt">Observable</span><span class="o">.</span><span class="nf">concat</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="nf">loadImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">lowResUrl</span><span class="p">)</span><span class="o">.</span><span class="n">orEmpty</span><span class="p">,</span>
                  <span class="n">loader</span><span class="o">.</span><span class="nf">loadImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">highResUtl</span><span class="p">)</span><span class="o">.</span><span class="n">orEmpty</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="n">imageView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="nv">$0</span> <span class="p">})</span>
    <span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>
</code></pre>
<h1 id='image-pipeline-a-name-h_design-a' class='heading'>Image Pipeline<a name="h_design"></a></h1>

<p>Nuke&rsquo;s image pipeline consists of roughly five stages which can be customized using the following protocols:</p>

<table><thead>
<tr>
<th>Protocol</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code><a href="Protocols/DataLoading.html">DataLoading</a></code></td>
<td>Download (or return cached) image data</td>
</tr>
<tr>
<td><code><a href="Protocols/DataDecoding.html">DataDecoding</a></code></td>
<td>Convert data into image objects</td>
</tr>
<tr>
<td><code><a href="Protocols/Processing.html">Processing</a></code></td>
<td>Apply image transformations</td>
</tr>
<tr>
<td><code><a href="Protocols/Caching.html">Caching</a></code></td>
<td>Store image into memory cache</td>
</tr>
</tbody></table>

<p>All those types come together the way you expect:</p>

<ol>
<li><code><a href="Classes/Manager.html">Manager</a></code> checks if the image is in memory cache (<code><a href="Protocols/Caching.html">Caching</a></code>). If not it asks <code><a href="Classes/Loader.html">Loader</a></code> to load it.</li>
<li><code><a href="Classes/Loader.html">Loader</a></code> uses underlying data loader (<code><a href="Protocols/DataLoading.html">DataLoading</a></code>) to fetch (or return cached) image data.</li>
<li>When the image data is loaded <code><a href="Classes/Loader.html">Loader</a></code> decodes (<code><a href="Protocols/DataDecoding.html">DataDecoding</a></code>) creating an image object.</li>
<li>The image is then processed (<code><a href="Protocols/Processing.html">Processing</a></code>) and returned to <code><a href="Classes/Manager.html">Manager</a></code>.</li>
<li><code><a href="Classes/Manager.html">Manager</a></code> stores the processed image in the memory cache (<code><a href="Protocols/Caching.html">Caching</a></code>).</li>
</ol>

<blockquote>
<p>There are some upcoming changes to this pipeline in Nuke 7.</p>
</blockquote>

<p>Nuke is fully asynchronous (non-blocking). Each stage is executed on a separate queue tailored specifically for it. Let&rsquo;s dive into each of those stages.</p>
<h3 id='data-loading-and-caching' class='heading'>Data Loading and Caching</h3>

<p>A built-in <code><a href="Classes/DataLoader.html">DataLoader</a></code> class implements <code><a href="Protocols/DataLoading.html">DataLoading</a></code> protocol and uses <a href="https://developer.apple.com/reference/foundation/nsurlsession"><code>Foundation.URLSession</code></a> to load image data. The data is cached on disk using a <a href="https://developer.apple.com/reference/foundation/urlcache"><code>Foundation.URLCache</code></a> instance, which by default is initialized with a memory capacity of 0 MB (Nuke stores images in memory, not image data) and a disk capacity of 150 MB.</p>

<blockquote>
<p>See <a href="https://kean.github.io/post/image-caching">Image Caching Guide</a> to learn more about image caching</p>

<p>See <a href="https://github.com/kean/Nuke/blob/master/Documentation/Guides/Third%20Party%20Libraries.md#using-other-caching-libraries">Third Party Libraries</a> guide to learn how to use a custom data loader or cache</p>
</blockquote>

<p>Most developers either implement their own networking layer or use a third-party framework. Nuke supports both of those workflows. You can integrate your custom networking layer by implementing <code><a href="Protocols/DataLoading.html">DataLoading</a></code> protocol.</p>

<blockquote>
<p>See <a href="https://github.com/kean/Nuke-Alamofire-Plugin">Alamofire Plugin</a> that implements <code><a href="Protocols/DataLoading.html">DataLoading</a></code> protocol using <a href="https://github.com/Alamofire/Alamofire">Alamofire</a> framework</p>
</blockquote>
<h3 id='memory-cache' class='heading'>Memory Cache</h3>

<p>A processed images which are ready to be displayed are stored in a fast in-memory cache (<code><a href="Classes/Cache.html">Cache</a></code>). It uses <a href="https://en.wikipedia.org/wiki/Cache_algorithms#Examples">LRU (least recently used)</a> replacement algorithm and has a limit which prevents it from using more than ~20% of available RAM. As a good citizen, <code><a href="Classes/Cache.html">Cache</a></code> automatically evicts images on memory warnings and removes most of the images when the application enters background.</p>
<h3 id='deduplicating-requests' class='heading'>Deduplicating Requests</h3>

<p>By default <code><a href="Classes/Loader.html">Loader</a></code> combines the requests with the same <code>loadKey</code> into a single task. The task&rsquo;s priority is set to the highest priority of registered requests and gets updated when requests are added or removed to the task. The task only gets cancelled when all the registered requests are.</p>

<blockquote>
<p>Deduplication can be disabled using <code><a href="Classes/Loader/Options.html">Loader.Options</a></code>.</p>
</blockquote>
<h1 id='performance-a-name-h_performance-a' class='heading'>Performance<a name="h_performance"></a></h1>

<p>Performance is one of the key differentiating factors for Nuke. There are three key components of its performance:</p>
<h3 id='main-thread-performance' class='heading'>Main-Thread Performance</h3>

<p>The framework has been tuned to do very little work on the main thread. In fact, it&rsquo;s <a href="https://github.com/kean/Image-Frameworks-Benchmark">at least 2.3x faster</a> than its fastest competitor. There are a number of optimizations techniques that were used to achieve that including: reducing number of allocations, reducing dynamic dispatch, backing some structs by reference typed storage to reduce ARC overhead, etc.</p>
<h3 id='robustness-under-stress' class='heading'>Robustness Under Stress</h3>

<p>A common use case is to dynamically start and cancel requests for a collection view full of images when scrolling at a high speed. There are a number of components that ensure robustness in those kinds of scenarios:</p>

<ul>
<li><code><a href="Classes/Loader.html">Loader</a></code> schedules each stage of the image pipeline on a dedicated queue. Each queue limits the number of concurrent tasks. This way we don&rsquo;t use too much system resources at any given moment and each stage doesn&rsquo;t block the other. For example, if the image doesn&rsquo;t require processing, it doesn&rsquo;t go through the processing queue.</li>
<li>Under stress <code><a href="Classes/Loader.html">Loader</a></code> will rate limit the requests to prevent trashing of the underlying systems (e.g. <code>URLSession</code>).</li>
</ul>
<h3 id='memory-usage' class='heading'>Memory Usage</h3>

<ul>
<li>Nuke tries to free memory as early as possible.</li>
<li>Memory cache uses <a href="https://en.wikipedia.org/wiki/Cache_algorithms#Examples">LRU (least recently used)</a> replacement algorithm. It has a limit which prevents it from using more than ~20% of available RAM. As a good citizen, <code><a href="Classes/Cache.html">Cache</a></code> automatically evicts images on memory warnings and removes most of the images when the application enters background.</li>
</ul>
<h1 id='extensions-a-name-h_plugins-a' class='heading'>Extensions<a name="h_plugins"></a></h1>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="https://github.com/kean/RxNuke"><strong>RxNuke</strong></a></td>
<td><a href="https://github.com/ReactiveX/RxSwift">RxSwift</a> extensions for Nuke with examples of common use cases solved by Rx</td>
</tr>
<tr>
<td><a href="https://github.com/kean/Nuke-Alamofire-Plugin"><strong>Alamofire</strong></a></td>
<td>Replace networking layer with <a href="https://github.com/Alamofire/Alamofire">Alamofire</a> and combine the power of both frameworks</td>
</tr>
<tr>
<td><a href="https://github.com/kean/Nuke-Gifu-Plugin"><strong>Gifu</strong></a></td>
<td>Use <a href="https://github.com/kaishin/Gifu">Gifu</a> to load and display animated GIFs</td>
</tr>
<tr>
<td><a href="https://github.com/kean/Nuke-AnimatedImage-Plugin"><strong>FLAnimatedImage</strong></a></td>
<td>Use <a href="https://github.com/Flipboard/FLAnimatedImage">FLAnimatedImage</a> to load and display <a href="(https://www.youtube.com/watch?v=fEJqQMJrET4)">animated GIFs</a></td>
</tr>
</tbody></table>
<h1 id='requirements-a-name-h_requirements-a' class='heading'>Requirements<a name="h_requirements"></a></h1>

<ul>
<li>iOS 9.0 / watchOS 2.0 / macOS 10.11 / tvOS 9.0</li>
<li>Xcode 9</li>
<li>Swift 4</li>
</ul>
<h1 id='license' class='heading'>License</h1>

<p>Nuke is available under the MIT license. See the LICENSE file for more info.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2018 <a class="link" href="https://github.com/kean" target="_blank" rel="external">kean</a>. All rights reserved. (Last updated: 2018-04-09)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
